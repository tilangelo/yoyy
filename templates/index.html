<!DOCTYPE html>
<html>
<head>
    <title>Product Search</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body class="container mt-4">

<h1>Поиск товаров</h1>

<div class="collapse show" id="filters">
<form method="get" action="/search" class="row g-3 mb-4">

    <div class="col-md-4">
        <input
            type="text"
            name="q"
            value="{{ query }}"
            class="form-control"
            placeholder="Поиск">
    </div>

    <div class="col-md-2">
        <input
            type="number"
            name="price_from"
            value="{{ price_from }}"
            class="form-control"
            placeholder="Цена от">
    </div>

    <div class="col-md-2">
        <input
            type="number"
            name="price_to"
            value="{{ price_to }}"
            class="form-control"
            placeholder="Цена до">
    </div>

    <div class="col-md-2">
        <select name="brand" class="form-select">
            <option value="">Все бренды</option>
            {% for b in brands %}
                <option value="{{ b }}"
                    {% if b == brand %}selected{% endif %}>
                    {{ b }}
                </option>
            {% endfor %}
        </select>
    </div>

    <div class="col-md-2">
        <select name="sort" class="form-select">
            <option value="">Без сортировки</option>
            <option value="price_asc" {% if sort == "price_asc" %}selected{% endif %}>Цена ↑</option>
            <option value="price_desc" {% if sort == "price_desc" %}selected{% endif %}>Цена ↓</option>
            <option value="rating_desc" {% if sort == "rating_desc" %}selected{% endif %}>Рейтинг ↓</option>
        </select>
    </div>

    <div class="col-md-12">
        <button type="submit" class="btn btn-primary">
            Применить
        </button>
        <a href="/search" class="btn btn-secondary">
            Сбросить
        </a>
    </div>

</form>
</div>


<div class="row">
{% for p in products %}
    <div class="col-md-4 mb-3">
        <div class="card h-100">
            {% if p.image_url %}
            <img src="{{ p.image_url }}" class="card-img-top">
            {% endif %}
            <div class="card-body">
                <h5>{{ p.canonical_name }}</h5>
                <p><b>от {{ p.min_price }} ₽</b></p>
                <p>Рейтинг: {{ "%.1f"|format(p.max_rating) if p.max_rating else "—" }}</p>
                <a href="/product/{{ p.id }}" class="btn btn-primary">
                    Подробнее
                </a>
            </div>
        </div>
    </div>
{% endfor %}
</div>

</body>
</html>
